<!DOCTYPE html>
<html>
  <head>
    <title><%= @global_config['INSTALLATION_NAME'] %></title>
    <%= csrf_meta_tags %>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <script>
      window.chatwootWebChannel = {
        avatarUrl: '<%= @web_widget.inbox.avatar_url %>',
        channelAvatarUrl: '<%= @web_widget.avatar_url %>',
        hasAConnectedAgentBot: '<%= @web_widget.inbox.agent_bot&.name %>',
        locale: '<%= @web_widget.account.locale %>',
        websiteName: '<%= @web_widget.inbox.name %>',
        websiteToken: '<%= @web_widget.website_token %>',
        welcomeTagline: '<%= @web_widget.welcome_tagline %>',
        welcomeTitle: '<%= @web_widget.welcome_title %>',
        widgetColor: '<%= @web_widget.widget_color %>',
        portal: <%= @web_widget.inbox.portal.to_json.html_safe %>,
        enabledFeatures: <%= @web_widget.selected_feature_flags.to_json.html_safe %>,
        enabledLanguages: <%= available_locales_with_name.to_json.html_safe %>,
        replyTime: '<%= @web_widget.reply_time %>',
        preChatFormEnabled: <%= @web_widget.pre_chat_form_enabled %>,
        preChatFormOptions: <%= @web_widget.pre_chat_form_options.to_json.html_safe %>,
        workingHoursEnabled: <%= @web_widget.inbox.working_hours_enabled %>,
        csatSurveyEnabled: <%= @web_widget.inbox.csat_survey_enabled %>,
        workingHours: <%= @web_widget.inbox.working_hours.to_json.html_safe %>,
        outOfOfficeMessage: <%= @web_widget.inbox.out_of_office_message.to_json.html_safe %>,
        utcOffset: '<%= ActiveSupport::TimeZone[@web_widget.inbox.timezone].now.formatted_offset %>',
        timezone: '<%= @web_widget.inbox.timezone %>',
        allowMessagesAfterResolved: <%= @web_widget.inbox.allow_messages_after_resolved %>,
        disableBranding: <%= @web_widget.inbox.account.feature_enabled?('disable_branding') %>,
        faqs: <%= @web_widget.faqs.to_json.html_safe %>,
        needMoreHelpType: '<%= @web_widget.need_more_help_type %>',
        backPopulateConversation: <%= @web_widget.back_populates_conversation %>,
        chatOnWhatsappSettings: <%= (@web_widget.additional_attributes['chat_on_whatsapp_settings'] || { enabled: false, button_text: 'Send Us a Text on WhatsApp', default_text: 'Hey! I need help with something.', phone_number: '' }).to_json.html_safe %>,
        aiMessageSettings: <%= (@web_widget.additional_attributes['ai_message_settings'] || { show_indicators: true }).to_json.html_safe %>,
        widgetTextSettings: <%= (@web_widget.additional_attributes['widget_text_settings'] || { ask_question_text: 'Ask a question' }).to_json.html_safe %>,
        defaultCountryCode: '<%= @web_widget.additional_attributes['default_country_code'] || 'IN' %>',
        defaultDialCode: '<%= @web_widget.additional_attributes['default_dial_code'] || '+91' %>'
      }
      window.chatwootPubsubToken = '<%= @contact_inbox.pubsub_token %>'
      window.authToken = '<%= @token %>'
      window.globalConfig = <%= raw @global_config.to_json %>
    </script>
    <%= javascript_pack_tag 'widget' %>
    <%= stylesheet_pack_tag 'widget' %>
  </head>
  <body>
    <div id="app"></div>
    <%= yield %>
  </body>
</html>
