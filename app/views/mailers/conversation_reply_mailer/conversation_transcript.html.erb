<% @messages.each do |message| %>
  <tr>
    <td>
      <% sender_name = message.sender&.try(:available_name) || message.sender&.name %>
      <% if @inbox.email? %>
        <% if sender_name.present? %>
          <b>From:</b> <%= sender_name %> <%= "<#{message.sender&.email}>" %>
          <br>
        <% end %>
        <% subject = message.conversation&.additional_attributes&.dig('mail_subject')%>
        <% if subject.present? %>
          <b>Subject:</b> <%= subject %>
          <br>
        <% end %>
      <% else %>
        <b><%= sender_name %></b>
      <% end %>
    </td>
  </tr>
  <tr>
    <td style="padding-bottom: 32px;">
      <% if message.content %>
        <%= ChatwootMarkdownRenderer.new(message.content).render_message %>
      <% end %>
      <% if message.attachments %>
        <% message.attachments.each do |attachment| %>
          Attachment [<a href="<%= attachment.file_url %>" _target="blank">Click here to view</a>]
        <% end %>
      <% end %>
      <p style="font-size: 90%; font-size: 90%;color: #899096;margin-top: -8px; margin-bottom: 0px;">
      <% if @inbox.timezone.present? %>
        <%= message.created_at.in_time_zone(@inbox.timezone).strftime('%b %d, %I:%M %p %Z') %>
      <% else %>
        <%= message.created_at.strftime('%b %d, %I:%M %p %Z') %>
      <% end %>
      </p>
    </td>
  </tr>
<% end %>
