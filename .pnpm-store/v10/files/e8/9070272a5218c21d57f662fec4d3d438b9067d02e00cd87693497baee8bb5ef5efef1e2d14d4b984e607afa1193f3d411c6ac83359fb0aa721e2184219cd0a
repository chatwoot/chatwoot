{"version":3,"file":"integration.js","sources":["../../src/integration.ts"],"sourcesContent":["import { defineIntegration, hasTracingEnabled } from '@sentry/core';\nimport type { Client, IntegrationFn } from '@sentry/types';\nimport { GLOBAL_OBJ, arrayify, consoleSandbox } from '@sentry/utils';\n\nimport { DEFAULT_HOOKS } from './constants';\nimport { DEBUG_BUILD } from './debug-build';\nimport { attachErrorHandler } from './errorhandler';\nimport { createTracingMixins } from './tracing';\nimport type { Options, Vue, VueOptions } from './types';\n\nconst globalWithVue = GLOBAL_OBJ as typeof GLOBAL_OBJ & { Vue: Vue };\n\nconst DEFAULT_CONFIG: VueOptions = {\n  Vue: globalWithVue.Vue,\n  attachProps: true,\n  logErrors: true,\n  hooks: DEFAULT_HOOKS,\n  timeout: 2000,\n  trackComponents: false,\n};\n\nconst INTEGRATION_NAME = 'Vue';\n\nconst _vueIntegration = ((integrationOptions: Partial<VueOptions> = {}) => {\n  return {\n    name: INTEGRATION_NAME,\n    setup(client) {\n      _setupIntegration(client, integrationOptions);\n    },\n  };\n}) satisfies IntegrationFn;\n\nexport const vueIntegration = defineIntegration(_vueIntegration);\n\nfunction _setupIntegration(client: Client, integrationOptions: Partial<VueOptions>): void {\n  const options: Options = { ...DEFAULT_CONFIG, ...client.getOptions(), ...integrationOptions };\n  if (!options.Vue && !options.app) {\n    consoleSandbox(() => {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `[@sentry/vue]: Misconfigured SDK. Vue specific errors will not be captured.\nUpdate your \\`Sentry.init\\` call with an appropriate config option:\n\\`app\\` (Application Instance - Vue 3) or \\`Vue\\` (Vue Constructor - Vue 2).`,\n      );\n    });\n    return;\n  }\n\n  if (options.app) {\n    const apps = arrayify(options.app);\n    apps.forEach(app => vueInit(app, options));\n  } else if (options.Vue) {\n    vueInit(options.Vue, options);\n  }\n}\n\nconst vueInit = (app: Vue, options: Options): void => {\n  if (DEBUG_BUILD) {\n    // Check app is not mounted yet - should be mounted _after_ init()!\n    // This is _somewhat_ private, but in the case that this doesn't exist we simply ignore it\n    // See: https://github.com/vuejs/core/blob/eb2a83283caa9de0a45881d860a3cbd9d0bdd279/packages/runtime-core/src/component.ts#L394\n    const appWithInstance = app as Vue & {\n      _instance?: {\n        isMounted?: boolean;\n      };\n    };\n\n    const isMounted = appWithInstance._instance && appWithInstance._instance.isMounted;\n    if (isMounted === true) {\n      consoleSandbox(() => {\n        // eslint-disable-next-line no-console\n        console.warn(\n          '[@sentry/vue]: Misconfigured SDK. Vue app is already mounted. Make sure to call `app.mount()` after `Sentry.init()`.',\n        );\n      });\n    }\n  }\n\n  attachErrorHandler(app, options);\n\n  if (hasTracingEnabled(options)) {\n    app.mixin(\n      createTracingMixins({\n        ...options,\n        ...options.tracingOptions,\n      }),\n    );\n  }\n};\n"],"names":[],"mappings":";;;;;;;AAUA,MAAM,aAAA,GAAgB,UAAW,EAAA;AACjC;AACA,MAAM,cAAc,GAAe;AACnC,EAAE,GAAG,EAAE,aAAa,CAAC,GAAG;AACxB,EAAE,WAAW,EAAE,IAAI;AACnB,EAAE,SAAS,EAAE,IAAI;AACjB,EAAE,KAAK,EAAE,aAAa;AACtB,EAAE,OAAO,EAAE,IAAI;AACf,EAAE,eAAe,EAAE,KAAK;AACxB,CAAC,CAAA;AACD;AACA,MAAM,gBAAA,GAAmB,KAAK,CAAA;AAC9B;AACA,MAAM,eAAA,IAAmB,CAAC,kBAAkB,GAAwB,EAAE,KAAK;AAC3E,EAAE,OAAO;AACT,IAAI,IAAI,EAAE,gBAAgB;AAC1B,IAAI,KAAK,CAAC,MAAM,EAAE;AAClB,MAAM,iBAAiB,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAA;AACnD,KAAK;AACL,GAAG,CAAA;AACH,CAAC,CAAE,EAAA;AACH;MACa,cAAe,GAAE,iBAAiB,CAAC,eAAe,EAAC;AAChE;AACA,SAAS,iBAAiB,CAAC,MAAM,EAAU,kBAAkB,EAA6B;AAC1F,EAAE,MAAM,OAAO,GAAY,EAAE,GAAG,cAAc,EAAE,GAAG,MAAM,CAAC,UAAU,EAAE,EAAE,GAAG,oBAAoB,CAAA;AAC/F,EAAE,IAAI,CAAC,OAAO,CAAC,GAAI,IAAG,CAAC,OAAO,CAAC,GAAG,EAAE;AACpC,IAAI,cAAc,CAAC,MAAM;AACzB;AACA,MAAM,OAAO,CAAC,IAAI;AAClB,QAAQ,CAAC;AACT;AACA,4EAA4E,CAAC;AAC7E,OAAO,CAAA;AACP,KAAK,CAAC,CAAA;AACN,IAAI,OAAM;AACV,GAAE;AACF;AACA,EAAE,IAAI,OAAO,CAAC,GAAG,EAAE;AACnB,IAAI,MAAM,OAAO,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAA;AACtC,IAAI,IAAI,CAAC,OAAO,CAAC,GAAI,IAAG,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAA;AAC9C,SAAS,IAAI,OAAO,CAAC,GAAG,EAAE;AAC1B,IAAI,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;AACjC,GAAE;AACF,CAAA;AACA;AACA,MAAM,UAAU,CAAC,GAAG,EAAO,OAAO,KAAoB;AACtD,EAAE,IAAI,WAAW,EAAE;AACnB;AACA;AACA;AACA,IAAI,MAAM,eAAgB,GAAE,GAAI;;AAI5B,CAAA;AACJ;AACA,IAAI,MAAM,SAAU,GAAE,eAAe,CAAC,SAAU,IAAG,eAAe,CAAC,SAAS,CAAC,SAAS,CAAA;AACtF,IAAI,IAAI,SAAU,KAAI,IAAI,EAAE;AAC5B,MAAM,cAAc,CAAC,MAAM;AAC3B;AACA,QAAQ,OAAO,CAAC,IAAI;AACpB,UAAU,sHAAsH;AAChI,SAAS,CAAA;AACT,OAAO,CAAC,CAAA;AACR,KAAI;AACJ,GAAE;AACF;AACA,EAAE,kBAAkB,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;AAClC;AACA,EAAE,IAAI,iBAAiB,CAAC,OAAO,CAAC,EAAE;AAClC,IAAI,GAAG,CAAC,KAAK;AACb,MAAM,mBAAmB,CAAC;AAC1B,QAAQ,GAAG,OAAO;AAClB,QAAQ,GAAG,OAAO,CAAC,cAAc;AACjC,OAAO,CAAC;AACR,KAAK,CAAA;AACL,GAAE;AACF,CAAC;;;;"}