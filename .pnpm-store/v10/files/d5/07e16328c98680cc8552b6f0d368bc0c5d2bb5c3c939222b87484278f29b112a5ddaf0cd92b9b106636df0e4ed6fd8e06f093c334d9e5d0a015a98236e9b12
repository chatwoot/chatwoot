{"version":3,"file":"errorhandler.js","sources":["../../src/errorhandler.ts"],"sourcesContent":["import { captureException } from '@sentry/core';\nimport { consoleSandbox } from '@sentry/utils';\n\nimport type { ViewModel, Vue, VueOptions } from './types';\nimport { formatComponentName, generateComponentTrace } from './vendor/components';\n\ntype UnknownFunc = (...args: unknown[]) => void;\n\nexport const attachErrorHandler = (app: Vue, options: VueOptions): void => {\n  const { errorHandler, warnHandler, silent } = app.config;\n\n  app.config.errorHandler = (error: Error, vm: ViewModel, lifecycleHook: string): void => {\n    const componentName = formatComponentName(vm, false);\n    const trace = vm ? generateComponentTrace(vm) : '';\n    const metadata: Record<string, unknown> = {\n      componentName,\n      lifecycleHook,\n      trace,\n    };\n\n    if (options.attachProps && vm) {\n      // Vue2 - $options.propsData\n      // Vue3 - $props\n      if (vm.$options && vm.$options.propsData) {\n        metadata.propsData = vm.$options.propsData;\n      } else if (vm.$props) {\n        metadata.propsData = vm.$props;\n      }\n    }\n\n    // Capture exception in the next event loop, to make sure that all breadcrumbs are recorded in time.\n    setTimeout(() => {\n      captureException(error, {\n        captureContext: { contexts: { vue: metadata } },\n        mechanism: { handled: false },\n      });\n    });\n\n    if (typeof errorHandler === 'function') {\n      (errorHandler as UnknownFunc).call(app, error, vm, lifecycleHook);\n    }\n\n    if (options.logErrors) {\n      const hasConsole = typeof console !== 'undefined';\n      const message = `Error in ${lifecycleHook}: \"${error && error.toString()}\"`;\n\n      if (warnHandler) {\n        (warnHandler as UnknownFunc).call(null, message, vm, trace);\n      } else if (hasConsole && !silent) {\n        consoleSandbox(() => {\n          // eslint-disable-next-line no-console\n          console.error(`[Vue warn]: ${message}${trace}`);\n        });\n      }\n    }\n  };\n};\n"],"names":["formatComponentName","generateComponentTrace","captureException","consoleSandbox"],"mappings":";;;;;;MAQa,kBAAmB,GAAE,CAAC,GAAG,EAAO,OAAO,KAAuB;AAC3E,EAAE,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,MAAA,EAAS,GAAE,GAAG,CAAC,MAAM,CAAA;AAC1D;AACA,EAAE,GAAG,CAAC,MAAM,CAAC,YAAa,GAAE,CAAC,KAAK,EAAS,EAAE,EAAa,aAAa,KAAmB;AAC1F,IAAI,MAAM,gBAAgBA,8BAAmB,CAAC,EAAE,EAAE,KAAK,CAAC,CAAA;AACxD,IAAI,MAAM,KAAM,GAAE,EAAG,GAAEC,iCAAsB,CAAC,EAAE,CAAE,GAAE,EAAE,CAAA;AACtD,IAAI,MAAM,QAAQ,GAA4B;AAC9C,MAAM,aAAa;AACnB,MAAM,aAAa;AACnB,MAAM,KAAK;AACX,KAAK,CAAA;AACL;AACA,IAAI,IAAI,OAAO,CAAC,WAAY,IAAG,EAAE,EAAE;AACnC;AACA;AACA,MAAM,IAAI,EAAE,CAAC,QAAA,IAAY,EAAE,CAAC,QAAQ,CAAC,SAAS,EAAE;AAChD,QAAQ,QAAQ,CAAC,SAAU,GAAE,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAA;AAClD,aAAa,IAAI,EAAE,CAAC,MAAM,EAAE;AAC5B,QAAQ,QAAQ,CAAC,SAAA,GAAY,EAAE,CAAC,MAAM,CAAA;AACtC,OAAM;AACN,KAAI;AACJ;AACA;AACA,IAAI,UAAU,CAAC,MAAM;AACrB,MAAMC,qBAAgB,CAAC,KAAK,EAAE;AAC9B,QAAQ,cAAc,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,EAAE,QAAS,EAAA,EAAG;AACvD,QAAQ,SAAS,EAAE,EAAE,OAAO,EAAE,OAAO;AACrC,OAAO,CAAC,CAAA;AACR,KAAK,CAAC,CAAA;AACN;AACA,IAAI,IAAI,OAAO,YAAa,KAAI,UAAU,EAAE;AAC5C,MAAM,CAAC,YAAA,GAA6B,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,aAAa,CAAC,CAAA;AACvE,KAAI;AACJ;AACA,IAAI,IAAI,OAAO,CAAC,SAAS,EAAE;AAC3B,MAAM,MAAM,UAAW,GAAE,OAAO,OAAA,KAAY,WAAW,CAAA;AACvD,MAAM,MAAM,OAAQ,GAAE,CAAC,SAAS,EAAE,aAAa,CAAC,GAAG,EAAE,KAAM,IAAG,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAA;AACjF;AACA,MAAM,IAAI,WAAW,EAAE;AACvB,QAAQ,CAAC,WAAA,GAA4B,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,CAAC,CAAA;AACnE,OAAM,MAAO,IAAI,cAAc,CAAC,MAAM,EAAE;AACxC,QAAQC,oBAAc,CAAC,MAAM;AAC7B;AACA,UAAU,OAAO,CAAC,KAAK,CAAC,CAAC,YAAY,EAAE,OAAO,CAAC,EAAA,KAAA,CAAA,CAAA,CAAA,CAAA;AACA,SAAA,CAAA,CAAA;AACA,OAAA;AACA,KAAA;AACA,GAAA,CAAA;AACA;;;;"}