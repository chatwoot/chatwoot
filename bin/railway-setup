#!/bin/bash
set -e

echo "ðŸš€ Railway Setup Script para Chatwoot"

# Generar claves secretas si no existen
if [ -z "$SECRET_KEY_BASE" ]; then
  export SECRET_KEY_BASE=$(openssl rand -hex 64)
  echo "âœ… SECRET_KEY_BASE generado"
fi

if [ -z "$DEVISE_JWT_SECRET_KEY" ]; then
  export DEVISE_JWT_SECRET_KEY=$(openssl rand -hex 64)
  echo "âœ… DEVISE_JWT_SECRET_KEY generado"
fi

# Ejecutar migraciones
echo "ðŸ“¦ Ejecutando migraciones..."
bundle exec rails db:migrate

# Precompilar assets si no estÃ¡n compilados
if [ ! -d "public/assets" ]; then
  echo "ðŸŽ¨ Precompilando assets..."
  bundle exec rails assets:precompile
fi

echo "âœ¨ Setup completado exitosamente!"